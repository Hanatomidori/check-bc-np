<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>問い合わせ状況検索</title>
  <style>
    body { font-family: "メイリオ", sans-serif; font-size: 18px; background: #f9f9f9; color: #222; padding: 20px; }
    select, input { font-size: 18px; padding: 8px; margin: 5px 0; width: 100%; max-width: 300px; }
    button { font-size: 20px; padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 6px; cursor: pointer; margin-top: 10px; }
    button:hover { background: #45a049; }
  </style>
</head>
<body>
  <h2>問い合わせ状況検索</h2>

  <label>対象年月（必須）：</label>
  <select id="monthSelect">
    <option value="">-- 選択してください --</option>
  </select><br>

  <label>受注番号：</label><input id="orderNo" type="text"><br>
  <label>挙式日：</label><input id="date" type="text"><br>
  <label>新郎姓：</label><input id="groom" type="text"><br>
  <label>新婦姓：</label><input id="bride" type="text"><br>

  <button onclick="search()">検索</button>
  <div id="result"></div>

  <script>
    let allResults = [];
    let currentPage = 1;

    google.script.run.withSuccessHandler(setMonths).getSheetNames();

    function setMonths(months) {
      const sel = document.getElementById('monthSelect');
      months.forEach(m => {
        const opt = document.createElement('option');
        opt.value = m;
        opt.textContent = m;
        sel.appendChild(opt);
      });
    }

    function search() {
      const targetMonth = document.getElementById('monthSelect').value;
      if (!targetMonth) {
        alert('対象年月を選択してください。');
        return;
      }

      const params = {
        targetMonth: targetMonth,
        orderNo: document.getElementById('orderNo').value.trim(),
        date: document.getElementById('date').value.trim(),
        groom: document.getElementById('groom').value.trim(),
        bride: document.getElementById('bride').value.trim()
      };

      // ここで params を確認ログ出し（デバッグ用）
      console.log("送信パラメータ:", params);

      google.script.run.withSuccessHandler(showResults).searchData(params);
    }

    function showResults(results) {
      console.log("結果:", results);
      const resultDiv = document.getElementById('result');
      if (!results || results.length === 0) {
        resultDiv.innerHTML = "<p>該当データがありません。</p>";
        return;
      }

      let html = "<table border='1'><tr><th>受注番号</th><th>挙式日</th><th>新郎</th><th>新婦</th><th>バックカラー</th><th>ネームプレート</th></tr>";
      results.forEach(r => {
        html += `<tr>
          <td>${r.orderNo}</td>
          <td>${r.date}</td>
          <td>${r.groom}</td>
          <td>${r.bride}</td>
          <td>${r.bk}</td>
          <td>${r.plateStatus}</td>
        </tr>`;
      });
      html += "</table>";
      resultDiv.innerHTML = html;
    }
  </script>
</body>
</html>
