<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>問い合わせ状況検索</title>
<style>
/* ← ここは前回のスマホ対応スタイルをそのまま利用（省略可） */
</style>
</head>

<body>
  <h1>問い合わせ状況検索</h1>

  <form id="searchForm">
    <label>対象年月（必須）：</label>
    <select id="targetMonth" required></select>

    <label>受注番号：</label>
    <input type="text" id="orderNo" placeholder="例）69431">

    <label>挙式日：</label>
    <input type="text" id="weddingDate" placeholder="例）9月12日">

    <label>新郎姓：</label>
    <input type="text" id="groomName" placeholder="例）山田">

    <label>新婦姓：</label>
    <input type="text" id="brideName" placeholder="例）佐藤">

    <button type="submit">検索</button>
  </form>

  <div class="table-container">
    <table id="resultTable">
      <thead>
        <tr>
          <th>受注番号</th>
          <th>挙式日</th>
          <th>新郎</th>
          <th>新婦</th>
          <th>バックカラー</th>
          <th>ネームプレート</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  google.script.run.withSuccessHandler(renderMonthOptions).getMonthList();
});

function renderMonthOptions(months) {
  const select = document.getElementById("targetMonth");
  select.innerHTML = '<option value="">選択してください</option>';
  months.forEach(m => {
    const opt = document.createElement("option");
    opt.value = m;
    opt.textContent = m;
    select.appendChild(opt);
  });
}

document.getElementById("searchForm").addEventListener("submit", (e) => {
  e.preventDefault();
  const params = {
    month: document.getElementById("targetMonth").value,
    orderNo: document.getElementById("orderNo").value,
    weddingDate: document.getElementById("weddingDate").value,
    groom: document.getElementById("groomName").value,
    bride: document.getElementById("brideName").value,
  };
  google.script.run.withSuccessHandler(renderResults).searchData(params);
});

function renderResults(data) {
  const tbody = document.querySelector("#resultTable tbody");
  tbody.innerHTML = "";
  data.forEach(row => {
    const tr = document.createElement("tr");

    // 色判定
    if (row.backColor === "対象外") tr.classList.add("status-gray");
    else if (row.backColor === "問い合わせ中") tr.classList.add("status-inquiry");
    else if (row.backColor && row.backColor !== "問い合わせ中") tr.classList.add("status-green");

    tr.innerHTML = `
      <td>${row.orderNo}</td>
      <td>${row.date}</td>
      <td>${row.groom}</td>
      <td>${row.bride}</td>
      <td>${row.backColor}</td>
      <td>${row.namePlate}</td>
    `;
    tbody.appendChild(tr);
  });
}
</script>
</body>
</html>
